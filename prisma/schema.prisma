// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  pending
  accepted
  rejected
}

enum GameStatus {
  pending
  ongoing
  completed
  aborted
}

enum PlayAs {
  white
  black
  random
}

enum Color {
  white
  black
}

enum Role {
  pawn
  bishop
  knight
  rook
  queen
  king
}

enum Turn {
  playerWhite
  playerBlack
}

enum Castle {
  whiteQueen
  whiteKing
  blackQueen
  blackKing
}

model User {
  id           String       @id @default(uuid())
  email        String       @unique
  username     String       @unique
  password     String?
  avatar       String?
  elo          Int          @default(400)
  country      String       @default("us")
  googleId     String?
  friends      Friend[]     @relation("UserFriends")
  friended     Friend[]     @relation("UserFriended")
  invitations  Invitation[] @relation("UserInvitations")
  invited      Invitation[] @relation("UserInvited")
  gamesAsWhite Game[]       @relation("PlayerWhite")
  gamesAsBlack Game[]       @relation("PlayerBlack")
  gamesWon     Game[]       @relation("winner")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Friend {
  id       String @id @default(uuid())
  user     User   @relation("UserFriends", fields: [userId], references: [id])
  userId   String
  friend   User   @relation("UserFriended", fields: [friendId], references: [id])
  friendId String
  status   Status @default(pending)
  read     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, friendId])
}

model Invitation {
  id        String   @id @default(uuid())
  from      User     @relation("UserInvitations", fields: [fromId], references: [id], onDelete: Cascade)
  fromId    String
  to        User     @relation("UserInvited", fields: [toId], references: [id], onDelete: Cascade)
  toId      String
  duration  Int
  timeId    String
  rated     Boolean  @default(true)
  playAs    PlayAs   @default(random)
  status    Status   @default(pending)
  invitedAt DateTime @default(now())
  read      Boolean  @default(false)
  gameId    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Game {
  id            String     @id @default(uuid())
  playerWhite   User       @relation("PlayerWhite", fields: [playerWhiteId], references: [id], onDelete: Cascade)
  playerWhiteId String
  playerBlack   User       @relation("PlayerBlack", fields: [playerBlackId], references: [id], onDelete: Cascade)
  playerBlackId String
  duration      Int
  timeId        String
  rated         Boolean    @default(true)
  startedAt     DateTime   @default(now())
  status        GameStatus @default(ongoing)
  history       String[]
  drawOffer     String?
  currentPosition  String[] @default(["wra1","wnb1","wbc1","wqd1","wke1","wbf1","wng1","wrh1","wpa2","wpb2","wpc2","wpd2","wpe2","wpf2","wpg2","wph2","bra8","bnb8","bbc8","bqd8","bke8","bbf8","bng8","brh8","bpa7","bpb7","bpc7","bpd7","bpe7","bpf7","bpg7","bph7"])
  winner User? @relation("winner", fields: [winnerId], references: [id], onDelete: Cascade)
  winnerId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
